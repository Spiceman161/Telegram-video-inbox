# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Å—Ç–æ—Ä–æ–Ω –≤–∏–¥–µ–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –æ–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Å—Ç–æ—Ä–æ–Ω - —Ä–∞—Å—Ç—è–Ω—É—Ç—ã–º –ø–æ —à–∏—Ä–∏–Ω–µ. –ü—Ä–∏ —ç—Ç–æ–º –Ω–∞ —Å–∞–º–æ–º TV-BOX –≤–∏–¥–µ–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–º–µ–Ω–Ω–æ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ Telegram.

## –ü—Ä–∏—á–∏–Ω–∞

–ö–æ–≥–¥–∞ –≤–∏–¥–µ–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `send_video` –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `width` –∏ `height`, Telegram –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –∏ –∏—Å–∫–∞–∑–∏—Ç—å –≤–∏–¥–µ–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é `ffprobe` –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:

1. **–ù–æ–≤–∞—è —É—Ç–∏–ª–∏—Ç–∞**: `bot/utils/video_metadata.py`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ffprobe` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã, –≤—ã—Å–æ—Ç—ã –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

2. **–û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**: `bot/handlers/callbacks.py` ‚Üí `handle_download()`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤–∏–¥–µ–æ
   - –ü–µ—Ä–µ–¥–∞–µ—Ç `width`, `height`, `duration` –∏ `supports_streaming=True` –≤ `send_video()`
   - –ò–º–µ–µ—Ç fallback –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–î–ª—è —Ä–∞–±–æ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **ffmpeg** (–≤–∫–ª—é—á–∞–µ—Ç ffprobe).

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ffmpeg –≤ Termux

```bash
pkg install ffmpeg
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
ffprobe -version
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ffprobe

```python
ffprobe -v quiet -print_format json -show_streams -select_streams v:0 video.mp4
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- `-v quiet` - —É–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω–∏–π –≤—ã–≤–æ–¥
- `-print_format json` - –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON
- `-show_streams` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Ç–æ–∫–∞—Ö
- `-select_streams v:0` - –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤—ã–π –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã send_video

```python
await bot.send_video(
    chat_id=chat_id,
    video=file_path,
    caption=caption,
    width=1920,              # –®–∏—Ä–∏–Ω–∞ –≤–∏–¥–µ–æ
    height=1080,             # –í—ã—Å–æ—Ç–∞ –≤–∏–¥–µ–æ
    duration=120,            # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    supports_streaming=True  # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
)
```

**–í–∞–∂–Ω–æ**: –£–∫–∞–∑–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö `width` –∏ `height` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Å–∫–∞–∂–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω Telegram –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–µ–æ.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∏–¥–µ–æ –±–æ—Ç—É
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üì• Inbox" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –∏ –Ω–∞–∂–º–∏—Ç–µ "‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:
- –í–∏–¥–µ–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è (fallback –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
- –û—à–∏–±–∫–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è (silent failure –≤ `get_video_metadata()`)
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è unsupported —Ñ–æ—Ä–º–∞—Ç–æ–≤

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ffprobe, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç:

```env
SEND_AS=document
```

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ Telegram –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ –∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ:
- –ù–µ –±—É–¥–µ—Ç preview –≤ —á–∞—Ç–µ
- –ù–µ –±—É–¥–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞
- –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä –ø—Ä–µ–≤—å—é
